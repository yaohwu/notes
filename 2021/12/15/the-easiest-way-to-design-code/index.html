<!DOCTYPE html>
<html lang="en">
  <head><meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>


<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">

<meta name="description" content="从最简单的规则开始设计"/><meta name="keywords" content="design pattern, yaohwu" /><link rel="alternate" href="/atom.xml" title="yaohwu" type="application/atom+xml"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=2.11.1" />
<link rel="canonical" href="https://notes.yaohwu.xyz/2021/12/15/the-easiest-way-to-design-code/"/>

<link rel="stylesheet" type="text/css" href="/lib/fancybox/jquery.fancybox.css" /><script type="text/x-mathjax-config">
    MathJax.Hub.Config({ tex2jax: { inlineMath: [['$','$'], ['\\(','\\)']] } });
  </script>
  <script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML"></script>
<link rel="stylesheet" type="text/css" href="/css/style.css?v=2.11.1" />

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-RCSCVVH4VT"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-RCSCVVH4VT');
</script><script>
  window.config = {"leancloud":{"app_id":null,"app_key":null},"toc":true,"fancybox":true,"pjax":"","latex":true};
</script>

    <title>从最简单的规则开始设计 - yaohwu</title>
  <meta name="generator" content="Hexo 5.4.0"></head>

  <body><div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/." class="logo">yaohwu</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>

<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list"><a href="/">
        <li class="mobile-menu-item">Home
          </li>
      </a><a href="/archives/">
        <li class="mobile-menu-item">Archives
          </li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags
          </li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories
          </li>
      </a><a href="/about/">
        <li class="mobile-menu-item">About
          </li>
      </a></ul>
</nav>
<div class="container" id="mobile-panel">
      <header id="header" class="header"><div class="logo-wrapper">
  <a href="/." class="logo">yaohwu</a>
</div>

<nav class="site-navbar"><ul id="menu" class="menu"><li class="menu-item">
          <a class="menu-item-link" href="/">
            Home
            </a>
        </li>
      <li class="menu-item">
          <a class="menu-item-link" href="/archives/">
            Archives
            </a>
        </li>
      <li class="menu-item">
          <a class="menu-item-link" href="/tags/">
            Tags
            </a>
        </li>
      <li class="menu-item">
          <a class="menu-item-link" href="/categories/">
            Categories
            </a>
        </li>
      <li class="menu-item">
          <a class="menu-item-link" href="/about/">
            About
            </a>
        </li>
      </ul></nav>
</header>

      <main id="main" class="main">
        <div class="content-wrapper">
          <div id="content" class="content"><article class="post">
    <header class="post-header">
      <h1 class="post-title">从最简单的规则开始设计
        </h1>

      <div class="post-meta">
        <span class="post-time">
          2021-12-15
        </span></div>
    </header>

    <div class="post-toc" id="post-toc">
    <h2 class="post-toc-title">Contents</h2>
    <div class="post-toc-content">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AF%BC%E5%BC%95"><span class="toc-text">导引</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E6%8A%8A%E6%A8%A1%E5%BC%8F%E8%A3%85%E5%88%B0%E8%84%91%E5%AD%90%E9%87%8C%EF%BC%9F"><span class="toc-text">如何把模式装到脑子里？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%A8%E4%BD%A0%E7%9A%84%E8%AE%BE%E8%AE%A1%E5%92%8C%E5%B7%B2%E6%9C%89%E7%9A%84%E5%BA%94%E7%94%A8%E4%B8%AD%E5%AF%BB%E6%89%BE%E4%BB%96%E4%BB%AC"><span class="toc-text">在你的设计和已有的应用中寻找他们</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%BB%E7%BB%93%E7%BB%8F%E9%AA%8C"><span class="toc-text">总结经验</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%87%8F%E5%B0%91%E9%87%8D%E5%A4%8D%E4%BB%A3%E7%A0%81"><span class="toc-text">减少重复代码</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8A%BD%E8%B1%A1"><span class="toc-text">抽象</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%A9%E5%B1%95%E6%80%A7%E6%80%9D%E8%80%83"><span class="toc-text">扩展性思考</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E7%BA%A6%E5%AE%9A%E5%87%8F%E5%B0%91%E7%89%B9%E5%AE%9A"><span class="toc-text">使用约定减少特定</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B3%9B%E5%9E%8B"><span class="toc-text">泛型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95"><span class="toc-text">单元测试</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-text">总结</span></a></li></ol>
    </div>
  </div><div class="post-content"><p>这篇文章大致讲一些自己对于代码设计的理解，总结一些经验做一个小组的分享。</p>
<span id="more"></span>

<h2 id="导引"><a href="#导引" class="headerlink" title="导引"></a>导引</h2><p>为什么从最简单的规则开始呢？</p>
<p>因为其实我是在代码设计方面没有特别深入的研究，单纯的拿《 head first 设计模式》中的案例来充当分享内容有点不妥，我自己最近也还在不断学习。</p>
<p>另外就是，正如书中所说：</p>
<blockquote>
<p>使用模式最好的方式是：“把模式装进脑子里，然后在你的设计和已有的应用中，寻找何处可以使用它们。”以往是代码复用，现在是经验复用。</p>
</blockquote>
<h3 id="如何把模式装到脑子里？"><a href="#如何把模式装到脑子里？" class="headerlink" title="如何把模式装到脑子里？"></a>如何把模式装到脑子里？</h3><p>可以通过看书来达成。最好还是看 《Head First 设计模式》，不要从网上看现成的文档，不要死记硬背。</p>
<ol>
<li><p>书的组织形式很好</p>
<ol>
<li>针对设计模式的应用场景进行分类，从对象，到装饰，到松耦合 OO，到封装，到适配和外观，到集合，到状态控制，到访问控制，有一整个的故事线，很有意思。</li>
<li>从简单的例子，到多模式的组合进阶使用，由易到难，由 demo 到生产；</li>
</ol>
<p><img src="https://yaohwu.xyz/link-image/static/F97LMr.png" alt="head first 设计模式 java 实现"></p>
</li>
<li><p>书的讲述形式很好</p>
<ol>
<li><p>不断的 Q&amp;A，不断的比较，容易引发自己的思考，印象也就更深刻；</p>
</li>
<li><p>你会发现，即使同一个模式，在不同场景下也是有不同的使用方案的，甚至这些方案在某些情况下看起来是违背了一些总结出来的原则，比如“优先使用组合而不是继承”，举个例子<a href="https://notes.yaohwu.xyz/2019/09/25/software-design/#%E9%80%82%E9%85%8D%E5%99%A8%E6%A8%A1%E5%BC%8F-Adapter-Pattern">适配器模式</a>；如果没有这样的思考，很容易对某一个模式产生偏见和错误理解。<br><img src="https://yaohwu.xyz/link-image/static/OoZCjB.png" alt="两种适配器的思辨"></p>
</li>
</ol>
</li>
</ol>
<h3 id="在你的设计和已有的应用中寻找他们"><a href="#在你的设计和已有的应用中寻找他们" class="headerlink" title="在你的设计和已有的应用中寻找他们"></a>在你的设计和已有的应用中寻找他们</h3><p>我也没有再花时间在我们的业务代码中找到具体的案例。</p>
<ol>
<li>我也是到分享的时候才发现，自己其实没有特别深入的学习过，脑海里一下子过不来这些东西；</li>
<li>时间的问题；</li>
<li>也觉得没有必要，自己去寻找，切身体会才是最好的。我分享的案例，只是我个人站在当初需求背景下的设计，而设计的好坏和需求又相关，在不同背景下的思考见仁见智。</li>
</ol>
<h2 id="总结经验"><a href="#总结经验" class="headerlink" title="总结经验"></a>总结经验</h2><p>既然上述两部分，都有更好的方案，那我就只能总结一下我个人最简单的经验。从比较务实的角度出发，将上层的理论交给更专业的方案去做。</p>
<p>我有哪些经验呢？毕竟我也是菜鸡，</p>
<p>所以我的经验也都比较简单，所以，还是回到题目，从最简单的规则开始，看看代码设计。</p>
<h3 id="减少重复代码"><a href="#减少重复代码" class="headerlink" title="减少重复代码"></a>减少重复代码</h3><p>这个可以说是最简单的规则了，没有之一。</p>
<p>毕竟，没有设计模式之前，至少也在强调，要实现代码复用。</p>
<blockquote>
<p>以往是代码复用，现在是经验复用。</p>
</blockquote>
<p>出现了大量的重复代码，那就不能实现代码复用，维护起来就得到处改。</p>
<p>重复的代码分类：</p>
<ul>
<li>方法出现重复的实现</li>
</ul>
<p>这个其实很容易理解，一个实现里面或者几个实现中，总是出现同样的方法块，idea 甚至都会帮助你识别出来。</p>
<p>比如我们业务中的统计逻辑，有好几处都要进行对模板信息的统计，但是是因为不同时期的功能，抄来抄去，没有再去整理，出现了大量的重复代码，维护起来，要改都得改。</p>
<p><img src="https://yaohwu.xyz/link-image/static/6NkWaT.png" alt="重复代码"></p>
<p>这些重复的逻辑甚至都出现在同样的方法中，几百行的方法，随着迭代越来越多，不断追加，没有时间去重构来减少重复代码。</p>
<ul>
<li>某个接口大量的实现类</li>
</ul>
<p>重复的方法块出现，肯定是封装出现了问题。还有一类重复，就是出现了大量的实现类。还拿埋点逻辑来说，<code>切入点的选择和切入的实现</code> 这个接口出现了大量的实现。</p>
<p><img src="https://yaohwu.xyz/link-image/static/iIDlKN.png" alt="大量的接口实现"></p>
<p>这当然也是一个设计上的问题。大量的实现类反映接口在易用性和抽象上的弊端。想要实现新的切入点的成本高昂。</p>
<ul>
<li>解决方案</li>
</ul>
<p>我们需要重新来设计，以实现减少重复代码的目的。</p>
<p>方法块的重复，在不同的场景下有多种选择。</p>
<ol>
<li>至少可以抽成公共的静态方法，带来的是稍微好维护；</li>
<li>也可以简单地进行抽象，使用继承，使用模板方法来处理；</li>
<li>也可以完全推倒原本的设计，实现一个针对模板的 parser，使用多个 parser 的组合来实现模板的读取和信息收集，对于其中的特殊的 parser 甚至还可以额外的抽象，比如针对控件列表的过滤，有些 parser 需要统计控件类型，有些 parser 需要统计个数，要让彼此独立却又在同一个便利中完成，那么就需要一个额外的抽象。</li>
<li>也可以 2 和 3 结合起来实现。</li>
</ol>
<p>接口大量的实现类的出现，要减轻这样的重复工作，就要抽象出一个更加合理的基本实现类，将原本的实现类变成一个个基本实现类的实例。</p>
<h3 id="抽象"><a href="#抽象" class="headerlink" title="抽象"></a>抽象</h3><p><strong>进行抽象的时候，要先有具象。</strong></p>
<p>这个具象不一定要已经有了实现，而是至少在你思考的过程中已经出现了的。</p>
<p>真正在处理业务的时候，可不像 demo 中那么简单。</p>
<blockquote>
<p>一个苹果，一个梨，那么自然会想到水果。</p>
</blockquote>
<p>要思考自身的业务分为哪几部分、哪些是可以归结到一个合理的结构上的。</p>
<p>基于不同的业务场合得到的抽象肯定也是完全不同的。</p>
<p>一个苹果一个梨，可能得到的是：</p>
<blockquote>
<p>一种植物。</p>
</blockquote>
<p>也可能是</p>
<blockquote>
<p>一种拥有外皮，可以吃的，长在对应果树上的东西。</p>
</blockquote>
<p>要结合具体的业务场景，找到最本质的部分，舍弃不关注的部分，最终得到一个抽象的结果。</p>
<h3 id="扩展性思考"><a href="#扩展性思考" class="headerlink" title="扩展性思考"></a>扩展性思考</h3><p>分层次的来思考扩展。</p>
<ul>
<li>有扩展性的必要么？</li>
</ul>
<p>要结合对应的业务场景来思考。</p>
<p>通常来说，涉及一个独立模块的功能，肯定是要考虑扩展性的。</p>
<p>但一个模块中的原本就具有可扩展性的一个扩展实现，就不需要考虑那么多，容易造成过度设计。</p>
<ul>
<li>有热替换的必要么？能不能实现热替换？</li>
</ul>
<p>要以松耦合的方式来实现。要依赖倒置，是不是要引入工厂方法，至少要有一个管理类来实现更新。</p>
<ul>
<li>能不能实现改动替换？改动替换时需要改哪些东西？</li>
</ul>
<p>改动替换时，是重新实现一个子类，还是针对已有的进行装饰，还是弄一个适配器。</p>
<p>这些在需要扩展的设计场景下要尽可能的思考到。让后续的扩展改动最小。</p>
<h3 id="使用约定减少特定"><a href="#使用约定减少特定" class="headerlink" title="使用约定减少特定"></a>使用约定减少特定</h3><p>一些设计模式是有固定使用场景的。不要在这些固定的使用场景下搞特定的设计。</p>
<p>比如 单例模式，虽然单例模式的写法很多，各种懒汉饿汉、双检索、枚举，但是他们对应的利弊和使用的场景一定要搞清楚。</p>
<p>还有一些其他好的代码方面的建议也是类似的。</p>
<p>比如针对 bean 的处理，getter setter 方法，开放的无参的构造器等等。</p>
<p>用于数据网络传输的 bean 和代码调用间的 bean 中间做一层转换，减少改动影响的范围。</p>
<p>比如，针对实例化时参数特别多的类，比如各种 bean，使用 builder 加上链式调用的方式来完成。</p>
<p><strong>固定的场景，选择固定的模式，使用固定的原则。</strong></p>
<h3 id="泛型"><a href="#泛型" class="headerlink" title="泛型"></a>泛型</h3><p>合理使用泛型，让编译器帮助你发现问题。</p>
<h3 id="单元测试"><a href="#单元测试" class="headerlink" title="单元测试"></a>单元测试</h3><p>借助单元测试来设计，朝着让单元测试更容易写的方向优化设计。</p>
<p>得到一个合理的抽象，合理的模块化拆分。</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>与其说我是来分享的，不如说我是来劝学的。</p>

      </div>
      <div class="post-copyright">
    <p class="copyright-item">
      <span>Author: </span>
      <a href="https://notes.yaohwu.xyz">yaohwu</a>
    </p>
    <p class="copyright-item">
      <span>Link: </span>
      <a href="https://notes.yaohwu.xyz/2021/12/15/the-easiest-way-to-design-code/">https://notes.yaohwu.xyz/2021/12/15/the-easiest-way-to-design-code/</a>
    </p>
    <p class="copyright-item">
      <span>License: </span><a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/" target="_blank">知识共享署名-非商业性使用 4.0 国际许可协议</a>
    </p>
  </div>
      <footer class="post-footer">
        <div class="post-tags">
            <a href="/tags/design-pattern/">design pattern</a>
            </div>
        
        <nav class="post-nav"><a class="prev" href="/2022/01/12/how-to-make-a-decision/">
        <i class="iconfont icon-left"></i>
        <span class="prev-text nav-default">how-to-make-a-decision</span>
        <span class="prev-text nav-mobile">Prev</span>
      </a>
    <a class="next" href="/2021/12/05/cloud-topic/">
        <span class="next-text nav-default">啥是云服务</span>
        <span class="prev-text nav-mobile">Next</span>
        <i class="iconfont icon-right"></i>
      </a>
    </nav></footer>
    </article></div><div class="comments" id="comments"><div id="disqus_thread">
        <noscript>
          Please enable JavaScript to view the
          <a target="_blank" rel="noopener" href="//disqus.com/?ref_noscript">comments powered by Disqus.</a>
        </noscript>
      </div>
    </div></div>
      </main>

      <footer id="footer" class="footer"><div class="social-links"><a href="mailto:yaohwu@163.com" class="iconfont icon-email" title="email"></a>
        <a target="_blank" rel="noopener" href="https://twitter.com/yaohwu" class="iconfont icon-twitter" title="twitter"></a>
        <a target="_blank" rel="noopener" href="https://github.com/yaohwu" class="iconfont icon-github" title="github"></a>
        <a target="_blank" rel="noopener" href="https://weibo.com/500856779" class="iconfont icon-weibo" title="weibo"></a>
        <a href="/atom.xml" class="iconfont icon-rss" title="rss"></a>
    </div><div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" target="_blank" rel="noopener" href="https://github.com/ahonn/hexo-theme-even">Even</a>
  </span>

  <span class="copyright-year">&copy;2015 - 2022<span class="heart">
      <i class="iconfont icon-heart"></i>
    </span>
    <span class="author">yaohwu</span>
  </span>
</div>
</footer>

      <div class="back-to-top" id="back-to-top">
        <i class="iconfont icon-up"></i>
      </div>
    </div><script type="text/javascript">
    var disqus_config = function () {
        this.page.url = 'https://notes.yaohwu.xyz/2021/12/15/the-easiest-way-to-design-code/';
        this.page.identifier = '2021/12/15/the-easiest-way-to-design-code/';
        this.page.title = '从最简单的规则开始设计';
    };
    (function() {
    var d = document, s = d.createElement('script');

    s.src = '//yaohwu-xyz.disqus.com/embed.js';

    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
    })();  
  </script><script type="text/javascript" src="/lib/jquery/jquery.min.js"></script>
  <script type="text/javascript" src="/lib/slideout/slideout.js"></script>
  <script type="text/javascript" src="/lib/fancybox/jquery.fancybox.pack.js"></script>
  <script type="text/javascript" src="/js/src/even.js?v=2.11.1"></script>
</body>
</html>
